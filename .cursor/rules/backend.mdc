---
description: Backend coding standards for Java and Spring Boot. applies to all files under src/main/java.
globs: src/main/java/**/*
---

# 1. Spring Boot & Java Standards
- **Language**: Java 17 (LTS).
- **Framework**: Spring Boot 3.2.x.
- **Lombok**: Use `@Getter`, `@RequiredArgsConstructor`, and `@Builder` actively.

# 2. Domain & JPA Rules
- **Entity Constraints**:
  - `@Setter` 금지. 상태 변경은 명확한 비즈니스 메서드 (`changePortfolioName()`) 사용.
  - 모든 엔티티는 `JPA Audit` 기능을 활용하기 위한 `BaseTimeEntity`를 상속합니다.
- **Performance (Anti-N+1)**:
  - 연관 관계는 기본적으로 `FetchType.LAZY`를 사용합니다.
  - 지연 로딩 문제를 해결하기 위해 **`Fetch Join`** 또는 **`EntityGraph`**를 명시적으로 사용하세요.
  - 엔티티의 `toString()` 구현 시 순환 참조가 발생하지 않도록 주의하세요 (연관 관계 필드 제외).

# 3. QueryDSL Patterns
- **BooleanExpression**: 단순 `where` 절보다 `BooleanExpression`을 반환하는 메서드로 분리하여 가독성과 재사용성을 높이세요.
- **Projections**: 대량 조회의 경우 엔티티 직접 조회보다 `Dto`로 필요한 필드만 조회(`Projections.constructor` 등)하는 것을 검토하세요.

# 4. API & DTO Standards
- **Standard Response**: 모든 API 응답은 일관된 `ApiResponse<T>` 래퍼 클래스를 사용합니다 (Success/Fail/Message/Data 구조).
- **Package**: DTO는 해당 도메인 패키지 내부의 `dto` 서브 패키지에 관리합니다.

# 5. Testing & Clean Code (Mandatory)
- **API Development Mandate**: 주요 API 개발 시 반드시 **성공/실패 케이스를 포함한 테스트 코드**를 동시 작성해야 합니다.
  - Controller: `MockMvc`를 이용한 슬라이스 테스트 또는 통합 테스트.
  - Service/Domain: JUnit 5와 AssertJ를 활용한 단위 테스트.
- **JUnit 5 & AssertJ**: 테스트 작성 시 이 라이브러리들을 기본으로 사용하며, `given-when-then` 패턴을 준수합니다.
- **Mocking**: 외부 서비스나 DB 연산은 `Mockito`를 활용하여 단위 테스트의 독립성을 보장하세요.
- **Method Length**: 하나의 메서드가 너무 많은 책임(30줄 이상)을 가지지 않게 하세요. 필요하면 private 메서드로 잘게 쪼개세요.
